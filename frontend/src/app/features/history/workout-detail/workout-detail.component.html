@if (workout()) {
  <app-page-container>
    <div class="workout-detail">
      <!-- Header -->
      <div class="detail-header">
        <button class="detail-header__back" routerLink="/history">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
        <div class="detail-header__info">
          <h1 class="detail-header__title">{{ workout()!.name }}</h1>
          <span class="detail-header__date">{{ formatFullDate(workout()!.completedAt!) }}</span>
        </div>
        <button class="detail-header__menu" (click)="showMenu = !showMenu">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="1"></circle>
            <circle cx="12" cy="5" r="1"></circle>
            <circle cx="12" cy="19" r="1"></circle>
          </svg>
        </button>

        @if (showMenu) {
          <div class="detail-header__dropdown">
            <button (click)="repeatWorkout()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="1 4 1 10 7 10"></polyline>
                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
              </svg>
              Repeat workout
            </button>
            <button (click)="saveAsTemplate()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="3" y1="9" x2="21" y2="9"></line>
                <line x1="9" y1="21" x2="9" y2="9"></line>
              </svg>
              Save as template
            </button>
            <button class="danger" (click)="showDeleteModal = true">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 6h18"></path>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
              </svg>
              Delete workout
            </button>
          </div>
        }
      </div>

      <!-- Summary Stats -->
      <div class="summary-stats">
        <div class="summary-stat">
          <span class="summary-stat__value">{{ workout()!.exercises.length }}</span>
          <span class="summary-stat__label">Exercises</span>
        </div>
        <div class="summary-stat">
          <span class="summary-stat__value">{{ workout()!.totalSets }}</span>
          <span class="summary-stat__label">Sets</span>
        </div>
        <div class="summary-stat">
          <span class="summary-stat__value">{{ settingsService.formatWeight(workout()!.totalVolume, false) }}</span>
          <span class="summary-stat__label">{{ settingsService.weightUnit() }} Volume</span>
        </div>
        <div class="summary-stat">
          <span class="summary-stat__value">{{ formatDuration(workout()!.duration || 0) }}</span>
          <span class="summary-stat__label">Duration</span>
        </div>
      </div>

      <!-- Notes -->
      @if (workout()!.notes) {
        <div class="notes-section">
          <h2 class="section-title">Notes</h2>
          <app-card>
            <p class="notes-text">{{ workout()!.notes }}</p>
          </app-card>
        </div>
      }

      <!-- Exercises -->
      <div class="exercises-section">
        <h2 class="section-title">Exercises</h2>
        <div class="exercises-list">
          @for (exercise of workout()!.exercises; track exercise.id) {
            <app-card>
              <div class="exercise-detail">
                <div class="exercise-detail__header">
                  <h3 class="exercise-detail__name">{{ exercise.exerciseName }}</h3>
                  <div class="exercise-detail__tags">
                    @for (muscle of getMuscleGroups(exercise.exerciseTemplateId).slice(0, 2); track muscle) {
                      <app-badge [size]="'sm'">{{ exerciseService.getMuscleGroupLabel(muscle) }}</app-badge>
                    }
                  </div>
                </div>

                <div class="sets-table">
                  <div class="sets-table__header">
                    <span>Set</span>
                    <span>Weight</span>
                    <span>Reps</span>
                  </div>
                  @for (set of exercise.sets; track set.id) {
                    @if (set.isCompleted) {
                      <div class="sets-table__row" [class.sets-table__row--warmup]="set.isWarmup">
                        <span>
                          @if (set.isWarmup) { W } @else { {{ set.setNumber }} }
                        </span>
                        <span>{{ set.actualWeight }} {{ settingsService.weightUnit() }}</span>
                        <span>{{ set.actualReps }}</span>
                      </div>
                    }
                  }
                </div>
              </div>
            </app-card>
          }
        </div>
      </div>
    </div>

    <!-- Delete Modal -->
    <app-modal
      [isOpen]="showDeleteModal"
      title="Delete Workout?"
      [showFooter]="true"
      size="sm"
      (closed)="showDeleteModal = false"
    >
      <p>Are you sure you want to delete this workout? This action cannot be undone.</p>
      <div modal-footer>
        <app-button variant="ghost" (clicked)="showDeleteModal = false">Cancel</app-button>
        <app-button variant="danger" (clicked)="deleteWorkout()">Delete</app-button>
      </div>
    </app-modal>
  </app-page-container>
}
